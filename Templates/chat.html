<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Chat App</title>
</head>
<body>
    <h1>
        {{user_name}}, welcome to chat room {{chat_room_id}}
    </h1>
    <div id = "messages"></div>

    <form id = "message_input_form">
        <input  type = "text" id = "message_input"placeholder="Enter your message here">
        <button type="submit">Send</button>
    </form>

</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
<script>
    const socket = io.connect("http://127.0.0.1:5000");
    socket.on('connect', function() {
        socket.emit('join_room', {
            user_name: "{{user_name}}",
            chat_room_id: "{{chat_room_id}}"
        })

        let message_input = document.getElementById('message_input');
        document.getElementById('message_input_form').onsubmit = function(e){
            e.preventDefault();

            let message = message_input.value.trim();

            if (message.length){
                socket.emit('send_message',{
                    user_name: '{{user_name}}', 
                    chat_room_id: '{{chat_room_id}}', 
                    message: message, 
                })
            }
            message_input.value = '';
            message_input.focus();

        }
    });

    socket.on('receive_message', function(data){
        console.log(data);
        if (data.username !== "{{ user_name }}") {
            const newNode = document.createElement('div');
            newNode.innerHTML = `<b>${data.user_name}:&nbsp;</b> ${data.message}`;
            document.getElementById('messages').appendChild(newNode);
        }
    });

    socket.on('join_room_announcement', function (data) {
        console.log(data);
        if (data.username !== "{{ user_name }}") {
            const newNode = document.createElement('div');
            newNode.innerHTML = `<b>${data.user_name}</b> has joined the room`;
            document.getElementById('messages').appendChild(newNode);
        }
    });

</script>
</html>